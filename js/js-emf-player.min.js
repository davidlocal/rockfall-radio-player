EMF.AppBanner={init:function(){(EMF.AppBanner.getOperatingSystem(),""===EMF.Variables.OperatingSystem)?$("#appBanner").remove():(EMF.AppBanner.setContent(),""!=EMF.AppBanner.getCookie("EMFAppBanner")?$("#appBanner").remove():$(".close-app-banner").click(function(){var t=new Date;t.setTime(t.getTime()+6048e5);var a="expires="+t.toUTCString();document.cookie="EMFAppBanner=HideBanner;"+a+";path=/"}))},getCookie:function(t){for(var a=t+"=",n=decodeURIComponent(document.cookie).split(";"),e=0;e<n.length;e++){for(var o=n[e];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(a))return o.substring(a.length,o.length)}return""},getOperatingSystem:function(){var t=navigator.userAgent||navigator.vendor||window.opera;/android/i.test(t)&&(EMF.Variables.OperatingSystem="Android"),/iPad|iPhone|iPod/.test(t)&&!window.MSStream&&(EMF.Variables.OperatingSystem="iOS")},setContent:function(){$("#appIcon").attr("src",EMF.Variables.AppBannerAppIcon),$("#appName").html(EMF.Variables.AppBannerAppName),"Android"===EMF.Variables.OperatingSystem?($("#appOsMesssage").html(EMF.Variables.AppBannerAndroidMessage),$("#appStoreLink").attr("href",EMF.Variables.AppBannerAndroidStoreLink)):($("#appOsMesssage").html(EMF.Variables.AppBanneriOSMessage),$("#appStoreLink").attr("href",EMF.Variables.AppBanneriOSStoreLink))}},EMF.Player={encoding:"hls",jwPlayer:null,playing:!1,refreshFullSongList:!0,init:function(){EMF.Variables.AutoPlay&&$(".audio-control-button").html("<i class='fas fa-spinner fa-pulse mr-3 text-third'></i>"),$(".audio-control-button").click(function(){EMF.Player.playStop()}),EMF.Player.bindGeneralSignupForm()},playStop:function(){null===EMF.Player.jwPlayer||"idle"===jwplayer().getState()?($(".audio-control-button").html("<i class='fas fa-spinner fa-pulse mr-3 text-third'></i>"),refreshFullSongList=!0,console.log("HLS Metadata active and clear signalR wait timer"),clearTimeout(EMF.SignalR.holdTimer),EMF.Player.setAudioSrc()):(window.plugin.fireStop(),jwplayer().stop(!0))},setAudioSrc:function(){var t={__RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val(),channel:EMF.Variables.SelectedChannel,encoding:EMF.Player.encoding};$.ajax({url:"/Home/GetStreamUrl",type:"POST",data:t,success:function(t){EMF.Variables.StreamSrc=t.streamUrl,EMF.Variables.StreamType=t.streamType,EMF.Player.jwPlayerInit()},error:function(t){console.log("GetStreamUrl Error"),$(".audio-control-button").html("<i class='fas fa-play mr-3 text-third'></i>PLAY")},fail:function(){console.log("GetStreamUrl Fail"),$(".audio-control-button").html("<i class='fas fa-play mr-3 text-third'></i>PLAY")}})},bindGeneralSignupForm:function(){$("#signup-form").submit(function(t){t.preventDefault();$(this);$("#signupBtn").prop("disabled",!0);var a={__RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val(),emailAddress:$("#signup-emailAddress").val(),formUrl:$("#signup-formUrl").val()};$.ajax({url:$(this).attr("action"),type:"POST",data:a,success:function(t){$("#signup-section").html(t)},error:function(t){$("#signupBtn").prop("disabled",!1)},fail:function(){$("#signupBtn").prop("disabled",!1)}})})},jwPlayerInit:function(){jwplayer.key="o8rj0oWhES4ATnz4fuw5P8LVaLpXMxjMlEl26ic4omFP8VgE",EMF.Player.jwPlayer=jwplayer("jwPlayerTag").setup({playlist:[{sources:[{file:EMF.Variables.StreamSrc,type:EMF.Variables.StreamType}]}],preload:"none",hlsjsdefault:!0,safarihlsjs:!0}),$(".audio-control-button").html("<i class='fas fa-spinner fa-pulse mr-3 text-third'></i>"),setYouboraOptions(),jwplayer().setVolume(EMF.VolControl.volume),jwplayer().play(!0),jwplayer().on("play",function(t){EMF.SignalR.stop(),EMF.Player.playing=!0,$(".audio-control-button").html("<i class='fas fa-stop mr-3 text-third'></i>STOP"),$(".audio-control-button").attr("data-event_action","stop")}),jwplayer().on("idle",function(t){EMF.SignalR.init(),EMF.Player.playing=!1,$(".audio-control-button").html("<i class='fas fa-play mr-3 text-third'></i>PLAY"),$(".audio-control-button").attr("data-event_action","play")}),jwplayer().on("meta",function(t){var a=jwplayer().getItemMeta().url;void 0!==a&&a.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i)&&(null!=a&&a!=EMF.PlayerMetaData.Songs[0].AutomationId?(console.log("HLS stream metadata updated to AutomationId="+a+" from AutomationId="+EMF.PlayerMetaData.Songs[0].AutomationId),EMF.PlayerMetaData.Songs[0].AutomationId=a,EMF.PlayerMetaData.getSongs(a)):refreshFullSongList=!1)})}},EMF.SignalR={urlBase:"",selectedChannel:"",hubConnection:"",run:!1,holdTimer:void 0,init:function(){console.log("SignalR init wait 10 seconds."),EMF.SignalR.holdTimer=setTimeout(function(){EMF.SignalR.run=!0,EMF.SignalR.negotiate()},1e4)},negotiate:function(){0==EMF.Player.playing&&$.ajax({url:EMF.SignalR.urlBase+"negotiate?Hub="+EMF.SignalR.selectedChannel+".Web",type:"POST",success:function(t){EMF.SignalR.connection(t.url,t.accessToken)},error:function(t){console.log("SignalR negotiate error"),setTimeout(function(){EMF.SignalR.init()},5e3)},fail:function(){console.log("SignalR negotiate fail"),setTimeout(function(){EMF.SignalR.init()},5e3)}})},connection:function(t,a){const n={accessTokenFactory:function(){return a}};EMF.SignalR.hubConnection=(new signalR.HubConnectionBuilder).withUrl(t,n).configureLogging(signalR.LogLevel.Information).build(),EMF.SignalR.hubConnection.on("songChanged",function(t){console.log("SignalR Song Changed"),console.log(t);var a=Object.create(EMF.PlayerMetaData.Song);a.SongId=t.SongId,a.AutomationId=t.AutomationId,a.Title=t.SongTitle,a.SongLink=t.SongUrl,a.Artist=t.ArtistName,a.ArtistId=t.ArtistId,a.ArtistLink=t.ArtistUrl,a.Image=t.AlbumImage,a.ArtistFacebook=t.ArtistFacebookUrl,a.ArtistTwitter=t.ArtistTwitterUrl,EMF.PlayerMetaData.Songs.unshift(a),EMF.PlayerMetaData.Songs.pop(),EMF.PlayerMetaData.update()}),EMF.SignalR.hubConnection.onclose(function(t){console.log("SignalR close"),EMF.SignalR.run&&EMF.SignalR.init()}),EMF.SignalR.start()},start:function(){try{EMF.SignalR.hubConnection.start()}catch(t){console.log("SignalR not connected try to re-negotiate error ="+t),EMF.SignalR.init()}},stop:function(){if(EMF.SignalR.run)try{EMF.SignalR.run=!1,EMF.SignalR.hubConnection.stop()}catch(t){console.log("SignalR stop error="+t),EMF.SignalR.init()}}},EMF.PlayerMetaData={Song:{SongId:"",AutomationId:"",Title:"",SongLink:"",ArtistId:"",Artist:"",ArtistLink:"",Image:"",ArtistFacebook:"",ArtistTwitter:""},Songs:[],init:function(){EMF.PlayerMetaData.Song.Image=$("#nowPlaying-image").attr("src"),EMF.PlayerMetaData.Song.Title=$("#nowPlaying-title").text(),EMF.PlayerMetaData.Song.SongId=$("#nowPlaying-title").attr("data-songId"),EMF.PlayerMetaData.Song.AutomationId=$("#nowPlaying-title").attr("data-automationId"),EMF.PlayerMetaData.Song.SongLink=$("#nowPlaying-songLink").attr("href"),EMF.PlayerMetaData.Song.ArtistId=$("#nowPlaying-artist").attr("data-artistId"),EMF.PlayerMetaData.Song.Artist=$("#nowPlaying-artist").text(),EMF.PlayerMetaData.Song.ArtistLink=$("#nowPlaying-artistLink").attr("href"),EMF.PlayerMetaData.Song.ArtistFacebook=$("#nowPlaying-artistFacebook").attr("href"),EMF.PlayerMetaData.Song.ArtistTwitter=$("#nowPlaying-artistTwitter").attr("href"),EMF.PlayerMetaData.Songs.push(EMF.PlayerMetaData.Song),EMF.PlayerMetaData.hideShow(),$(".last-played a").each(function(t){var a=Object.create(EMF.PlayerMetaData.Song);a.Title=$(this).find(".song-title").text(),a.Artist=$(this).find(".song-artist").text(),a.Image=$(this).find("img").attr("src"),a.SongLink=$(this).attr("href"),EMF.PlayerMetaData.Songs.push(a)})},update:function(){console.log("Update the songs on the page with data in the array"),$(".album-art").removeAttr("style"),$("#nowPlaying-image").attr("src",EMF.PlayerMetaData.Songs[0].Image),$("#nowPlaying-title").html(EMF.PlayerMetaData.Songs[0].Title),$("#nowPlaying-title").attr("data-songId",EMF.PlayerMetaData.Songs[0].SongId),$("#nowPlaying-title").attr("data-automationId",EMF.PlayerMetaData.Songs[0].AutomationId),$("#nowPlaying-songLink").attr("href",EMF.PlayerMetaData.Songs[0].SongLink),$("#nowPlaying-songLink-mobile").attr("href",EMF.PlayerMetaData.Songs[0].SongLink),$("#nowPlaying-artist").html(EMF.PlayerMetaData.Songs[0].Artist),$("#nowPlaying-artist").attr("data-artistId",EMF.PlayerMetaData.Songs[0].ArtistId),$("#nowPlaying-artistLink").attr("href",EMF.PlayerMetaData.Songs[0].ArtistLink),$("#nowPlaying-artistLink-mobile").attr("href",EMF.PlayerMetaData.Songs[0].ArtistLink),$("#nowPlaying-artistFacebook").attr("href",EMF.PlayerMetaData.Songs[0].ArtistFacebook),$("#nowPlaying-artistFacebook-dropdown-mobile").attr("href",EMF.PlayerMetaData.Songs[0].ArtistFacebook),$("#nowPlaying-artistTwitter").attr("href",EMF.PlayerMetaData.Songs[0].ArtistTwitter),$("#nowPlaying-artistTwitter-dropdown-mobile").attr("href",EMF.PlayerMetaData.Songs[0].ArtistFacebook),EMF.PlayerMetaData.hideShow(),$(".last-played a").each(function(t){$(this).find(".song-title").html(EMF.PlayerMetaData.Songs[t+1].Title),$(this).find(".song-artist").html(EMF.PlayerMetaData.Songs[t+1].Artist),$(this).find("img").attr("src",EMF.PlayerMetaData.Songs[t+1].Image),$(this).attr("href",EMF.PlayerMetaData.Songs[t+1].SongLink)})},hideShow:function(){void 0===$("#nowPlaying-artistFacebook").attr("href")||""===$("#nowPlaying-artistFacebook").attr("href")?($("#nowPlaying-artistFacebook").attr("style","display:none !important"),$("#nowPlaying-artistFacebook-dropdown-mobile").attr("style","display:none !important")):($("#nowPlaying-artistFacebook").attr("style",""),$("#nowPlaying-artistFacebook-dropdown-mobile").attr("style","")),void 0===$("#nowPlaying-artistTwitter").attr("href")||""===$("#nowPlaying-artistTwitter").attr("href")?($("#nowPlaying-artistTwitter").attr("style","display:none !important"),$("#nowPlaying-artistTwitter-dropdown-mobile").attr("style","display:none !important")):($("#nowPlaying-artistTwitter").attr("style",""),$("#nowPlaying-artistTwitter-dropdown-mobile").attr("style","")),void 0!==$("#nowPlaying-artistFacebook").attr("href")&&""!==$("#nowPlaying-artistFacebook").attr("href")||void 0!==$("#nowPlaying-artistTwitter").attr("href")&&""!==$("#nowPlaying-artistTwitter").attr("href")?$("#social-dropdown-mobile").attr("style",""):$("#social-dropdown-mobile").attr("style","display:none !important"),void 0===$("#nowPlaying-artistLink").attr("href")||""===$("#nowPlaying-artistLink").attr("href")?($("#nowPlaying-artistLink").attr("style","display:none !important"),$("#nowPlaying-artistLink-mobile").attr("style","display:none !important")):($("#nowPlaying-artistLink").attr("style",""),$("#nowPlaying-artistLink-mobile").attr("style","")),void 0===$("#nowPlaying-songLink").attr("href")||""===$("#nowPlaying-songLink").attr("href")?($("#nowPlaying-songLink").attr("style","display:none !important"),$("#nowPlaying-songLink-mobile").attr("style","display:none !important")):($("#nowPlaying-songLink").attr("style",""),$("#nowPlaying-songLink-mobile").attr("style",""))},getSongs:function(t){console.log("Get five songs and replace the song array"),$.get({url:EMF.Variables.SongServiceURL+"/"+EMF.Variables.SelectedChannelId+"/"+t+"?limit=5",beforeSend:function(t){t.setRequestHeader("Ocp-Apim-Subscription-Key",EMF.Variables.SongServiceKey)},type:"GET"}).done(function(t){console.log("Get five songs Call Success"),console.log(t);for(var a=0;a<5;a++)EMF.PlayerMetaData.Songs[a].SongId=t[a].songId,EMF.PlayerMetaData.Songs[a].AutomationId=t[a].automationId,EMF.PlayerMetaData.Songs[a].Title=t[a].songTitle,EMF.PlayerMetaData.Songs[a].SongLink=t[a].songUrl,EMF.PlayerMetaData.Songs[a].Artist=t[a].artistName,EMF.PlayerMetaData.Songs[a].ArtistId=t[a].artistId,EMF.PlayerMetaData.Songs[a].ArtistLink=t[a].artistUrl,EMF.PlayerMetaData.Songs[a].Image=t[a].albumImage,EMF.PlayerMetaData.Songs[a].ArtistFacebook=t[a].artistFacebookUrl,EMF.PlayerMetaData.Songs[a].ArtistTwitter=t[a].artistTwitterUrl;EMF.PlayerMetaData.update()}).fail(function(){console.log("Get five songs Call Fail")})}},EMF.VolControl={volume:80,init:function(){$("#volume").slider({range:"min",value:EMF.VolControl.volume,min:10,max:100,slide:function(t,a){EMF.VolControl.volume=a.value,null!==EMF.Player.jwPlayer&&jwplayer().setVolume(EMF.VolControl.volume),$("#volumeControl i").removeClass(),a.value<25&&$("#volumeControl i").addClass("icon-vol-empty"),a.value>24&a.value<75&&$("#volumeControl i").addClass("icon-vol-low"),a.value>74&&$("#volumeControl i").addClass("icon-vol-loud")}})}},$(function(){EMF.Player.init(),EMF.AppBanner.init(),EMF.VolControl.init(),EMF.PlayerMetaData.init()}),window.addEventListener("beforeunload",function(t){delete t.returnValue});